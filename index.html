<html>
   
   <head>
     <!-- HTTP 1.1 -->
     <meta http-equiv="Cache-Control" content="no-store"/>
     <!-- HTTP 1.0 -->
     <meta http-equiv="Pragma" content="no-cache"/>
     <!-- Prevents caching at the Proxy Server -->
     <meta http-equiv="Expires" content="0"/>
   </head>
   <body>
     <div id="testResultsArea" style="font-size:24px;width:200px;height:200px;"></div>
     <button id="lookAheadTriggerButton">Look Ahead Triggering</button>
     <button id="directTriggerButton">Direct Protocol Triggering</button>
     <div id="hiddenIframeContainer" style="display:none"></div>
   </body>
   <script>
     const testResultsArea = document.getElementById("testResultsArea")
     var testProtocolWindow = undefined;
    
     function openAndWait(ms) {
       testProtocolWindow = window.open("masterintraining23.github.io/myappprotocol.html", "", "width=1,height=1,titlebar=yes,menubar=yes,status=yes,top=23,left=36");
       testProtocolWindow.addEventListener("blur", () => console.log("blur"));
       setTimeout(() => testExistence(), ms);
     }

     window.isAppInstalled = 0;
      
     function testExistence() {
       console.log("isAppInstalled: " + window.isAppInstalled);
       if (window.isAppInstalled) {
         console.log(testProtocolWindow.location.hostname);
         testResultsArea.innerHTML = "Application Exists! :)";
       } else {
         testResultsArea.innerHTML = "Application Doesn't Exist. :(";
         console.log("failed");
       }
       testProtocolWindow.close();
     }
     
     function createProtocolIframe() {
       const iframe = document.createElement("iframe");
       iframe.src = "something://";
       return iframe;
     }
     
     const lookAheadButton = document.getElementById("lookAheadTriggerButton");
     lookAheadButton.addEventListener("click", () => openAndWait(350));
     
     const directButton = document.getElementById("directTriggerButton");
     const hiddenIframeContainer = document.getElementById("hiddenIframeContainer");
     directButton.addEventListener("click", () => {
       buttonState = 1;
       directButton.addEventListener("mousemove", () => {
         directButton.removeEventListener("mouseout");
         directButton.removeEventListener("blur");
       });
       directButton.addEventListener("blur", () => {
         window.isAppInstalled = 1;
       });
       directButton.addEventListener("mouseout", () => {
         window.isAppInstalled = 1;
       });
       hiddenIframeContainer.append(createProtocolIframe());
     });
     
   </script>
</html>
